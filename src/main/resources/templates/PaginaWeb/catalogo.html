<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cat√°logo de Tecnolog√≠a</title>

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- CSS -->
  <link rel="stylesheet" th:href="@{/css/PaginaWeb.css}">
  <link rel="icon" th:href="@{/img/logo.jpg}" type="image/jpg">

  <style>
    body { font-family: 'Poppins', sans-serif; }
  </style>
</head>

<body class="min-h-screen text-white bg-gradient-to-br from-[#0a1f44] via-[#0f2a5f] to-[#1b1f3b]">

  <!-- NAVBAR -->
  <nav class="fixed top-0 w-full bg-[#020617]/70 backdrop-blur-xl border-b border-cyan-400/20 text-white shadow z-50">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex justify-between items-center h-16">

        <!-- Logo -->
        <a th:href="@{/PaginaWeb/index}" class="text-xl font-bold text-cyan-400 tracking-wider">üíª TechNova</a>

        <!-- Bot√≥n m√≥vil -->
        <button id="menuBtn" class="md:hidden text-2xl">‚ò∞</button>

        <!-- Links -->
        <ul id="menu" class="hidden md:flex gap-6 items-center">

          <li><a th:href="@{/PaginaWeb/index}" class="hover:text-cyan-400 transition">Inicio</a></li>
          <li><a th:href="@{/catalogo}" class="hover:text-cyan-400 transition">Productos</a></li>

          <!-- Dropdown Categor√≠as -->
          <li class="relative group">
            <span class="cursor-pointer hover:text-cyan-400 transition">Categor√≠as</span>
            <ul class="absolute hidden group-hover:block bg-gray-800 mt-2 rounded shadow w-48">
              <li th:each="c : ${categorias}">
                <a th:href="@{'/catalogo?categoria=' + ${c.idCategoria}}"
                   th:text="${c.nombreCategoria}"
                   class="block px-4 py-2 hover:bg-red-500"></a>
              </li>
            </ul>
          </li>

          <li><a th:href="@{/nosotros}" class="hover:text-cyan-400 transition">Nosotros</a></li>
          <li><a th:href="@{/contacto}" class="hover:text-cyan-400 transition">Contacto</a></li>

          <li sec:authorize="!isAuthenticated()">
            <a th:href="@{/login}" class="bg-red-600 px-3 py-1 rounded">Login</a>
          </li>
          <li sec:authorize="!isAuthenticated()">
            <a th:href="@{/register}" class="border px-3 py-1 rounded">Registro</a>
          </li>

          <li sec:authorize="isAuthenticated()" class="flex items-center gap-4">
            <!-- Carrito -->
            <a th:href="@{/carrito}" class="relative hover:text-red-500 transition" title="Ver carrito">
              üõí
              <span th:if="${carritoCount != null and carritoCount > 0}"
                    th:text="${carritoCount}"
                    class="absolute -top-2 -right-3 bg-red-600 text-xs px-1.5 rounded-full">
              </span>
            </a>

            <!-- Usuario -->
            <div class="relative group">
              <span class="text-sm cursor-pointer hover:text-cyan-400 transition">
                Hola, <strong th:text="${nombreCom} ?: 'Usuario'"></strong> ‚åÑ
              </span>
              <ul class="absolute right-0 mt-2 w-40 bg-[#020617] border border-cyan-400/20 rounded-lg shadow-lg
                         opacity-0 invisible group-hover:opacity-100 group-hover:visible
                         transition-all duration-200 ease-in-out">
                <li>
                  <a th:href="@{/perfil}" class="block px-4 py-2 hover:bg-cyan-600 hover:text-white rounded-lg">üë§ Mi Perfil</a>
                </li>
              </ul>
            </div>

            <li sec:authorize="isAuthenticated()">
              <a th:href="@{/logout}" class="border px-3 py-1 rounded hover:bg-red-600 transition">Salir</a>
            </li>

          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO CAT√ÅLOGO -->
  <div class="max-w-7xl mx-auto px-6 pt-28 pb-16">

    <!-- SECCI√ìN PROMOCIONES -->
    <section th:if="${promociones != null and !#maps.isEmpty(promociones)}" class="mb-20">

      <div class="max-w-7xl mx-auto px-6">

        <!-- HERO PROMOCI√ìN -->
        <div th:each="promo, iter : ${promociones}" th:if="${iter.index == 0}" class="relative mb-20">
          <div class="relative rounded-3xl overflow-hidden bg-gradient-to-r from-pink-600 via-purple-600 to-indigo-600 p-14 shadow-2xl">
            <div class="absolute inset-0 bg-black/40"></div>

            <div class="relative z-10 grid md:grid-cols-2 gap-10 items-center">

              <div>
                <h2 class="text-5xl font-extrabold mb-6" th:text="${promo.key}">Promo</h2>
                <p class="text-lg text-gray-200 mb-8">Ofertas exclusivas por tiempo limitado.</p>
                <a th:href="@{/catalogo(promo=${promo.key})}"
                   class="inline-block bg-white text-black font-bold px-10 py-4 rounded-full hover:scale-105 transition">
                  Ver campa√±a ‚Üí
                </a>
              </div>

              <div class="grid grid-cols-2 gap-6">
                <div th:each="item, stat : ${promo.value}" th:if="${item.producto != null}" class="bg-white/10 backdrop-blur-lg rounded-2xl p-4">
                  <img th:src="@{'/img/' + ${item.producto.imagen != null ? item.producto.imagen : 'default.jpg'}}"
                       th:alt="${item.producto.nombre}" class="h-32 w-full object-cover rounded-lg mb-3"/>
                  <p class="text-sm font-semibold" th:text="${item.producto.nombre}">Producto</p>
                  <p class="text-xs text-red-300 font-bold" th:text="'-' + ${item.porcentaje} + '%'">-0%</p>

				  <!-- Precio con descuento -->
				  <p class="text-cyan-400 font-bold text-sm mt-1"
				     th:text="'S/ ' + ${item.precioConDescuento}">S/ 0.00</p>
                </div>
              </div>

            </div>
          </div>
        </div>

		<!-- PROMOS SECUNDARIAS -->
		<div th:each="promo, iter : ${promociones}" 
		     th:if="${iter.index > 0}" 
		     class="mb-16">

		  <div class="bg-[#0f172a]/80 backdrop-blur-xl border border-white/10 rounded-2xl p-8">
		    
		    <div class="flex justify-between items-center mb-6">
		      <h3 class="text-2xl font-bold text-pink-400" 
		          th:text="${promo.key}">
		          Promo Secundaria
		      </h3>

		      <a th:href="@{/catalogo(promo=${promo.key})}" 
		         class="text-sm text-cyan-400 hover:underline">
		        Ver promoci√≥n ‚Üí
		      </a>
		    </div>

		    <div class="flex gap-6 overflow-x-auto pb-4">

		      <div th:each="item : ${promo.value}" 
		           th:if="${item.producto != null}" 
		           class="min-w-[220px] bg-[#020617] border border-white/10 rounded-xl p-4">

		        <img th:src="@{'/img/' + ${item.producto.imagen != null ? item.producto.imagen : 'default.jpg'}}"
		             th:alt="${item.producto.nombre}" 
		             class="h-36 w-full object-cover rounded-lg mb-3"/>

		        <p class="text-sm font-semibold" 
		           th:text="${item.producto.nombre}">
		           Producto
		        </p>

		        <!-- Porcentaje -->
		        <p class="text-xs text-red-400 font-bold" 
		           th:text="'-' + ${item.porcentaje} + '%'">
		           -0%
		        </p>

		        <!-- Precio original tachado -->
		        <p class="text-xs text-gray-400 line-through"
		           th:text="'S/ ' + ${item.producto.precio}">
		           S/ 0.00
		        </p>

		        <!-- Precio con descuento -->
		        <p class="text-cyan-400 font-bold text-sm mt-1"
		           th:text="'S/ ' + ${item.precioConDescuento}">
		           S/ 0.00
		        </p>

		      </div>

		    </div>
		  </div>
		</div>

      </div>
    </section>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

      <!-- FILTROS -->
      <aside class="lg:col-span-1 bg-[#0f172a]/90 backdrop-blur-xl border border-white/10 rounded-2xl p-6 shadow-xl h-fit sticky top-24">
        <h3 class="text-lg font-bold text-pink-400 mb-6">Filtros</h3>

        <form th:action="@{/catalogo}" method="get" class="space-y-6">

          <!-- Buscador -->
          <div>
            <input type="text" name="buscar" th:value="${buscar}" placeholder="Buscar producto..."
                   class="w-full px-4 py-2 rounded-xl bg-[#020617] border border-white/10 focus:border-pink-500 focus:outline-none"/>
          </div>

          <!-- Orden -->
          <div>
            <select name="ordenar" class="w-full px-4 py-2 rounded-xl bg-[#020617] border border-white/10 focus:border-pink-500 focus:outline-none">
              <option value="">Ordenar</option>
              <option value="precioAsc" th:selected="${ordenar == 'precioAsc'}">Precio ‚Üë</option>
              <option value="precioDesc" th:selected="${ordenar == 'precioDesc'}">Precio ‚Üì</option>
            </select>
          </div>

          <!-- Categor√≠as -->
          <div class="space-y-3">
            <p class="text-sm text-gray-400">Categor√≠as</p>
            <div th:each="cat : ${categorias}">
              <a th:href="@{/catalogo(categoria=${cat.idCategoria})}"
                 th:text="${cat.nombreCategoria}"
                 class="block text-sm hover:text-pink-400 transition"></a>
            </div>
          </div>

		  <!-- Promociones -->
		  <div class="mb-6" th:if="${listaPromociones != null}">
		    <h3 class="text-pink-400 font-semibold mb-3">Promociones</h3>
		    <div th:each="promo : ${listaPromociones}">
		      <a th:href="@{/catalogo(promo=${promo})}"
		         class="block px-3 py-2 rounded-lg hover:bg-pink-600 hover:text-white transition text-pink-300"
		         th:text="${promo}"></a>
		    </div>
		  </div>

          <button type="submit" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 rounded-xl transition">
            Aplicar
          </button>

        </form>
      </aside>

      <!-- PRODUCTOS -->
      <main class="lg:col-span-3">

        <h2 class="text-3xl font-bold text-white mb-8">üõç Cat√°logo</h2>

        <!-- Sin resultados -->
        <div th:if="${productos == null or #lists.isEmpty(productos)}" class="text-gray-400 text-center mt-20">
          No se encontraron productos.
        </div>
		<!-- GRID -->
		<div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-8" th:if="${productos != null}">

		  <div th:each="prod : ${productos}" class="bg-[#020617]/70 backdrop-blur-xl border border-pink-400/10 rounded-2xl shadow-xl hover:scale-105 hover:shadow-pink-500/20 transition duration-300 overflow-hidden">

		    <div class="h-56 overflow-hidden">
		      <img th:src="@{'/img/' + ${prod.imagen != null ? prod.imagen : 'default.jpg'}}"
		           th:alt="${prod.nombre}" class="w-full h-full object-cover"/>
		    </div>

		    <div class="p-5 flex flex-col justify-between min-h-[260px]">
		      <h3 class="text-lg font-semibold text-blue-300 mb-2" th:text="${prod.nombre}">Producto</h3>
		      <p class="text-gray-400 text-sm mb-4 line-clamp-2" th:text="${prod.descripcion}">Descripci√≥n</p>

		      <div class="mt-auto">
		        <p class="text-blue-400 text-xl font-bold mb-3"
		           th:text="'S/ ' + ${#numbers.formatDecimal(prod.precio, 1, 'POINT', 2, 'POINT')}">S/ 0.00</p>

		        <a th:href="@{'/PaginaWeb/producto/detalle/' + ${prod.idProducto}}"
		           class="block text-center bg-pink-500 hover:bg-pink-600 text-white font-semibold py-2 rounded-xl transition">
		          Ver m√°s
		        </a>
		      </div>
		    </div>

		  </div>
		</div>

		<!-- PAGINACI√ìN -->
		<div class="flex justify-center mt-12 space-x-3" th:if="${totalPages > 0}">
		  <a th:if="${currentPage > 0}"
		     th:href="@{/catalogo(page=${currentPage - 1}, categoria=${categoriaSeleccionada}, buscar=${buscar}, ordenar=${ordenar})}"
		     class="px-4 py-2 bg-slate-800 rounded-lg hover:bg-red-600 text-white transition">Anterior</a>

		  <span class="px-4 py-2 bg-pink-500 text-white rounded-lg font-semibold"
		        th:text="${currentPage + 1} + ' / ' + ${totalPages}">1 / 1</span>

		  <a th:if="${currentPage + 1 < totalPages}"
		     th:href="@{/catalogo(page=${currentPage + 1}, categoria=${categoriaSeleccionada}, buscar=${buscar}, ordenar=${ordenar})}"
		     class="px-4 py-2 bg-slate-800 rounded-lg hover:bg-red-600 text-white transition">Siguiente</a>
		</div>

      </main>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="bg-[#020617]/80 backdrop-blur text-gray-300 border-t border-cyan-400/20">
    <div class="container mx-auto px-6 py-12">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-10 text-center md:text-left">

        <div>
          <h2 class="text-2xl font-bold text-red-500 mb-3">üíª TechNova</h2>
          <p class="text-gray-400 text-sm">La mejor experiencia de tecnolog√≠a con promociones y descuentos exclusivos.</p>
        </div>

        <div>
          <h3 class="font-semibold mb-3">Enlaces</h3>
          <ul class="space-y-2 list-none p-0 m-0">
            <li><a th:href="@{/PaginaWeb/index}" class="hover:text-red-500">Inicio</a></li>
            <li><a th:href="@{/catalogo}" class="hover:text-red-500">Productos</a></li>
            <li><a th:href="@{/nosotros}" class="hover:text-red-500">Nosotros</a></li>
            <li><a th:href="@{/contacto}" class="hover:text-red-500">Contacto</a></li>
          </ul>
        </div>

        <div>
          <h3 class="font-semibold mb-3">Contacto</h3>
          <p class="text-sm text-gray-400">Av. Wilson 123, Lima, Per√∫</p>
          <p class="text-sm text-gray-400">+51 987 654 321</p>
          <p class="text-sm text-gray-400">info@tecnologia.com</p>
        </div>
      </div>

      <hr class="my-8 border-gray-700">
      <p class="text-center text-gray-500 text-sm">¬© 2026 TechNova. Todos los derechos reservados.</p>
    </div>
  </footer>

</body>
</html>
