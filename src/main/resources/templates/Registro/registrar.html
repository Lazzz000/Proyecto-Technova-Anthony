<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Regístrate como cliente</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" th:href="@{/css/registrar.css}">
<link rel="icon" th:href="@{/img/logo.jpg}" type="image/jpg">
<style>
  /* Resalta campos válidos y errores */
  .is-valid { border-color: #28a745 !important; }
  .is-invalid { border-color: #dc3545 !important; }
</style>
</head>
<body>
<div class="registro-container">
    <div class="logo-container mb-3">
        <img th:src="@{/img/logo.jpg}" alt="Logo Cine">
    </div>

	<h4 class="fw-bold mb-3">Crea tu cuenta</h4>
	<p class="text-muted mb-4">Completa los datos para registrarte</p>

    <form th:action="@{/register}" th:object="${registroDto}" method="post" id="registroForm">

        <!-- Nombres y Apellidos -->
        <div class="row mb-3">
            <div class="col-md-6">
                <input type="text" id="cliente_nombres" th:field="*{cliente.nombres}" 
                       class="form-control" placeholder="Nombres">
                <div class="invalid-feedback" id="error-nombres"></div>
            </div>
            <div class="col-md-6">
                <input type="text" id="cliente_apellidos" th:field="*{cliente.apellidos}" 
                       class="form-control" placeholder="Apellidos">
                <div class="invalid-feedback" id="error-apellidos"></div>
            </div>
        </div>

        <!-- Género -->
        <div class="mb-3">
            <select id="cliente_genero" th:field="*{cliente.genero}" class="form-select">
                <option value="" disabled selected>Selecciona tu género</option>
                <option value="Hombre">Hombre</option>
                <option value="Mujer">Mujer</option>
            </select>
            <div class="invalid-feedback" id="error-genero"></div>
        </div>

        <!-- Fecha de nacimiento -->
        <div class="mb-3">
            <input type="date" id="cliente_fechaNacimiento" th:field="*{cliente.fechaNacimiento}" 
                   class="form-control">
            <div class="invalid-feedback" id="error-fechaNacimiento"></div>
        </div>

        <!-- Teléfono -->
        <div class="mb-3">
            <input type="text" id="cliente_telefono" th:field="*{cliente.telefono}" 
                   class="form-control" placeholder="Teléfono">
            <div class="invalid-feedback" id="error-telefono"></div>
        </div>

        <!-- Correo -->
        <div class="mb-3">
            <input type="email" id="usuario_correo" th:field="*{usuario.correo}" 
                   class="form-control" placeholder="Correo electrónico">
            <div class="invalid-feedback" id="error-correo"></div>
        </div>

        <!-- Contraseña -->
        <div class="mb-3">
            <input type="password" id="usuario_clave" th:field="*{usuario.clave}" 
                   class="form-control" placeholder="Contraseña">
            <div class="invalid-feedback" id="error-clave"></div>
        </div>

		<button type="submit" class="btn btn-registrar w-100" id="btnRegistrar">
		  Registrarse
		</button>


        <div th:if="${error}" class="alert alert-danger mt-3" th:text="${error}"></div>
        <div th:if="${success}" class="alert alert-success mt-3" th:text="${success}"></div>

        <div class="mt-3 text-center">
            <small>¿Ya tienes una cuenta? <a th:href="@{/login}">Inicia sesión</a></small>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const form = document.getElementById('registroForm');
    const btn = document.getElementById('btnRegistrar');

    const campos = [
        "cliente_nombres",
        "cliente_apellidos",
        "cliente_genero",
        "cliente_fechaNacimiento",
        "cliente_telefono",
        "usuario_correo",
        "usuario_clave"
    ];

    campos.forEach(id => {
        document.getElementById(id)
            .addEventListener('input', () => validarCampo(id));
    });

    function validarCampo(id) {
        const input = document.getElementById(id);
        const value = input.value.trim();
        let error = "";

        switch (id) {
            case "cliente_nombres":
                if (!value) error = "Los nombres son obligatorios.";
                break;
            case "cliente_apellidos":
                if (!value) error = "Los apellidos son obligatorios.";
                break;
            case "cliente_genero":
                if (!value) error = "Debes seleccionar un género.";
                break;
            case "cliente_fechaNacimiento":
                if (!value) error = "Debes ingresar tu fecha de nacimiento.";
                break;
            case "cliente_telefono":
                if (!/^\d{7,15}$/.test(value)) error = "Teléfono inválido.";
                break;
            case "usuario_correo":
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) error = "Correo inválido.";
                break;
            case "usuario_clave":
                if (value.length < 6) error = "Mínimo 6 caracteres.";
                break;
        }

        const errorDiv = document.getElementById(`error-${id.split('_')[1]}`);

        if (error) {
            input.classList.add('is-invalid');
            input.classList.remove('is-valid');
            errorDiv.textContent = error;
            return false;
        } else {
            input.classList.add('is-valid');
            input.classList.remove('is-invalid');
            errorDiv.textContent = "";
            return true;
        }
    }

    form.addEventListener('submit', e => {
        let valido = true;
        campos.forEach(id => {
            if (!validarCampo(id)) valido = false;
        });

        if (!valido) {
            e.preventDefault();
        } else {
            btn.innerText = "Registrando...";
            btn.disabled = true;
        }
    });

});
</script>
</body>
</html>

