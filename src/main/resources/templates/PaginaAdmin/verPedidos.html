<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
<meta charset="UTF-8">
<title>Pedidos - Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.tailwindcss.com"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100 font-poppins">

	<!-- Header -->
	<div class="fixed top-0 w-full z-50 bg-white shadow-md flex items-center justify-between px-6 py-4">
	    <div class="flex items-center gap-3 text-lg font-semibold text-gray-800">
	        <i class="fa-solid fa-user-shield text-green-500"></i>
	        Panel de Administraci√≥n
	    </div>
		<div class="flex items-center gap-6 text-gray-700">

		    <!-- ICONO MENSAJES -->
		    <a th:href="@{/PaginaAdmin/mensajes}"
		       class="relative text-gray-700 hover:text-green-600 transition">

		        <i class="fa-solid fa-envelope text-xl"></i>

		        <!-- Contador -->
		        <span th:if="${cantidadMensajesNoLeidos > 0}"
		              th:text="${cantidadMensajesNoLeidos}"
		              class="absolute -top-2 -right-3 bg-red-600 text-white text-xs px-1.5 rounded-full">
		        </span>
		    </a>

		    <!-- ADMIN INFO -->
		    <div>
		        Bienvenido:
		        <span class="font-semibold"
		              th:text="${adminNombre}">Admin</span>
		        <div class="text-gray-600 text-sm"
		             id="reloj">00/00/0000 00:00</div>
		    </div>

		</div>
	</div>

<div class="flex pt-20 min-h-screen">



	<!-- SIDEBAR -->
	<div class="w-60 bg-slate-900 text-gray-200 fixed top-20 left-0 h-[calc(100vh-5rem)] shadow-lg rounded-r-xl">
	    <nav class="flex flex-col mt-4 gap-1">

	        <!-- Dashboard -->
	        <a th:href="@{/PaginaAdmin/PanelAdmin}"
	           class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-slate-800 transition-all">
	            <i class="fa-solid fa-chart-line text-yellow-400"></i>
	            Dashboard
	        </a>

	        <!-- Clientes ACTIVO -->
	        <a th:href="@{/Cliente/listar}"
	           class="flex items-center gap-3 px-6 py-3 rounded-lg bg-slate-800 text-white font-semibold shadow">
	            <i class="fa-solid fa-users text-yellow-400"></i>
	            Clientes
	        </a>

	        <!-- Productos -->
	        <a th:href="@{/mantenimientoProductos/lista}"
	           class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-slate-800 transition-all">
	            <i class="fa-solid fa-box text-yellow-400"></i>
	            Productos
	        </a>

	        <!-- Pedidos -->
	        <a th:href="@{/admin/pedidos}"
	           class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-slate-800 transition-all">
	            <i class="fa-solid fa-shopping-cart text-yellow-400"></i>
	            Pedidos
	        </a>
			

			<!-- DESCUENTOS -->
			<a th:href="@{/mantenimientoDescuentos/listaDescuentos}"
			   class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-800 transition">
			    <i class="fa-solid fa-percent text-yellow-400"></i> Descuentos
			</a>

			<!-- PROMOCIONES -->
			<a th:href="@{/mantenimientoPromociones/listaPromociones}"
			   class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-800 transition">
			    <i class="fa-solid fa-bullhorn text-yellow-400"></i> Promociones
			</a>
			<!-- Mensajes -->
			          <a th:href="@{/PaginaAdmin/mensajes}"
			             class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-slate-800 transition-all">
			              <i class="fa-solid fa-envelope text-yellow-400"></i>
			              Mensajes
			          </a>

	        <!-- Logout -->
	        <a th:href="@{/logout}"
	           class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-red-600 transition-all">
	            <i class="fa-solid fa-right-from-bracket text-red-400"></i>
	            Cerrar sesi√≥n
	        </a>

	    </nav>
	</div>

	<!-- CONTENIDO -->
	<div class="ml-60 flex-1 p-8">

	<h2 class="text-3xl font-semibold mb-6">Lista de Pedidos</h2>
	<!-- FILTRO FECHAS -->
	<form th:action="@{/admin/pedidos/buscar}" method="get" class="row mb-4">

	<div class="col-md-3">
	<label>Desde</label>
	<input type="date" name="fechaInicio" class="form-control">
	</div>

	<div class="col-md-3">
	<label>Hasta</label>
	<input type="date" name="fechaFin" class="form-control">
	</div>

	<div class="col-md-3 align-self-end">
	<button class="btn btn-primary">
	<i class="fa fa-search"></i> Buscar
	</button>

	<a th:href="@{/admin/pedidos}" class="btn btn-secondary">Todos</a>
	</div>

	</form>

	<!-- TABLA -->
	<div class="bg-white rounded shadow p-4">
	<table id="tablaPedidos" class="table table-striped">

	<thead>
	<tr>
	<th>ID</th>
	<th>Cliente</th>
	<th>Receptor</th>
	<th>Fecha</th>
	<th>Total</th>
	<th>M√©todo</th>
	<th>Estado</th>
	<th>üëÅ</th>
	</tr>
	</thead>

	<tbody>

	<tr th:each="p : ${pedidos}">

	<td th:text="${p.idPedido}"></td>

	<td th:text="${p.cliente.nombres}"></td>

	<td th:text="${p.nombreReceptor}"></td>

	<td th:text="${#temporals.format(p.fechaPedido,'dd/MM/yyyy HH:mm')}"></td>

	<td th:text="'S/ ' + ${p.total}"></td>

	<td th:text="${p.metodoPago}"></td>

	<td>
	<span class="badge bg-success"
	      th:text="${p.estado}">
	</span>
	</td>

	<td>

	<a th:href="@{/admin/pedidos/ver/{id}(id=${p.idPedido})}"
	   class="btn btn-info btn-sm">

	<i class="fa fa-eye"></i>

	</a>

	</td>

	</tr>

	</tbody>
	</table>
	</div>

	</div>

	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

	<script>
	$(document).ready(function () {
	$('#tablaPedidos').DataTable({
	language:{url:'//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'}
	});
	});
	
		function actualizarReloj() {
		    const ahora = new Date();
		    const dia = String(ahora.getDate()).padStart(2, '0');
		    const mes = String(ahora.getMonth() + 1).padStart(2, '0'); // Enero = 0
		    const anio = ahora.getFullYear();
		    const hora = String(ahora.getHours()).padStart(2, '0');
		    const minutos = String(ahora.getMinutes()).padStart(2, '0');
		    const segundos = String(ahora.getSeconds()).padStart(2, '0');
		    document.getElementById('reloj').innerText = `${dia}/${mes}/${anio} ${hora}:${minutos}:${segundos}`;
		}

		// Actualiza cada segundo
		setInterval(actualizarReloj, 1000);
		actualizarReloj(); 
	</script>

	</body>
	</html>