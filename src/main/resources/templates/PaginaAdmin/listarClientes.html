<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lista de Clientes - Tecnologia</title>

    <!-- Fuente -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100 font-poppins">

<!-- HEADER -->
<div class="fixed top-0 w-full z-50 bg-white shadow-md flex items-center justify-between px-6 py-4">
    <div class="flex items-center gap-3 text-lg font-semibold text-gray-800">
        <i class="fa-solid fa-user-shield text-green-500"></i>
        Panel de Administración
    </div>
    <div class="text-gray-700 text-right">
          Bienvenido: <span class="font-semibold" th:text="${adminNombre}">Admin</span>
        <div class="text-gray-600 text-sm" id="reloj">00/00/0000 00:00</div>
    </div>
</div>

<!-- LAYOUT -->
<div class="flex pt-20 min-h-screen">

    <!-- SIDEBAR -->
    <div class="w-60 bg-slate-900 text-gray-200 fixed top-20 left-0 h-[calc(100vh-5rem)] shadow-lg rounded-r-xl">
        <nav class="flex flex-col mt-4 gap-1">

            <!-- Dashboard -->
            <a th:href="@{/PaginaAdmin/PanelAdmin}"
               class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-slate-800 transition-all">
                <i class="fa-solid fa-chart-line text-yellow-400"></i>
                Dashboard
            </a>

            <!-- Clientes ACTIVO -->
            <a th:href="@{/Cliente/listar}"
               class="flex items-center gap-3 px-6 py-3 rounded-lg bg-slate-800 text-white font-semibold shadow">
                <i class="fa-solid fa-users text-yellow-400"></i>
                Clientes
            </a>

            <!-- Productos -->
            <a th:href="@{/mantenimientoProductos/lista}"
               class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-slate-800 transition-all">
                <i class="fa-solid fa-box text-yellow-400"></i>
                Productos
            </a>

            <!-- Pedidos -->
            <a th:href="@{/admin/pedidos}"
               class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-slate-800 transition-all">
                <i class="fa-solid fa-shopping-cart text-yellow-400"></i>
                Pedidos
            </a>
			

			<!-- DESCUENTOS -->
			<a th:href="@{/mantenimientoDescuentos/listaDescuentos}"
			   class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-800 transition">
			    <i class="fa-solid fa-percent text-yellow-400"></i> Descuentos
			</a>

			<!-- PROMOCIONES -->
			<a th:href="@{/mantenimientoPromociones/listaPromociones}"
			   class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-800 transition">
			    <i class="fa-solid fa-bullhorn text-yellow-400"></i> Promociones
			</a>
			<!-- Mensajes -->
			          <a th:href="@{/PaginaAdmin/mensajes}"
			             class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-slate-800 transition-all">
			              <i class="fa-solid fa-envelope text-yellow-400"></i>
			              Mensajes
			          </a>

            <!-- Logout -->
            <a th:href="@{/logout}"
               class="flex items-center gap-3 px-6 py-3 rounded-lg hover:bg-red-600 transition-all">
                <i class="fa-solid fa-right-from-bracket text-red-400"></i>
                Cerrar sesión
            </a>

        </nav>
    </div>

    <!-- CONTENIDO -->
	<div class="ml-60 flex-1 p-8">

	    <h2 class="text-3xl font-semibold text-gray-800 mb-6">
	        Clientes Registrados
	    </h2>

	    <!-- ================== CARDS RESUMEN ================== -->
	    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">

	        <div class="bg-blue-600 text-white rounded-xl shadow p-5 text-center">
	            <p class="text-lg">Total Clientes</p>
	            <h2 class="text-4xl font-bold" th:text="${totalClientes}">0</h2>
	        </div>

	        <div class="bg-green-600 text-white rounded-xl shadow p-5 text-center">
	            <p class="text-lg">Clientes Activos</p>
	            <h2 class="text-4xl font-bold" th:text="${clientesActivos}">0</h2>
	        </div>

	        <div class="bg-red-600 text-white rounded-xl shadow p-5 text-center">
	            <p class="text-lg">Clientes Inactivos</p>
	            <h2 class="text-4xl font-bold" th:text="${clientesInactivos}">0</h2>
	        </div>

	    </div>

        <!-- MENSAJES -->
        <div th:if="${param.msg=='ok'}" class="alert alert-success">✅ Cliente actualizado correctamente</div>
        <div th:if="${param.msg=='fail'}" class="alert alert-danger">❌ Error al actualizar cliente</div>

		<!-- ================== FILTROS ================== -->
		<div class="row mb-3">
		    <div class="col">
		        <a th:href="@{/Cliente/listar}" class="btn btn-secondary btn-sm">
		            Todos
		        </a>
		        <a th:href="@{/Cliente/activos}" class="btn btn-success btn-sm">
		            Activos
		        </a>
		        <a th:href="@{/Cliente/inactivos}" class="btn btn-danger btn-sm">
		            Inactivos
		        </a>
		    </div>
		</div>
			
		  <!-- ================== TABLA ================== -->
		    <div class="overflow-x-auto bg-white rounded-xl shadow p-4">
		        <table id="tablaClientes" class="table table-striped table-bordered w-full">
		            <thead class="bg-gray-200 text-center">
		            <tr>
		                <th>ID</th>
		                <th>Nombre</th>
		                <th>Teléfono</th>
		                <th>Género</th>
		                <th>Fecha Nac.</th>
		                <th>Correo</th>
		                <th>Estado</th>
		                <th>Opciones</th>
		            </tr>
		            </thead>
		            <tbody>

		            <tr th:each="clie : ${listaCliente}">
		                <td th:text="${clie.idCliente}"></td>
		                <td th:text="${clie.nombres + ' ' + clie.apellidos}"></td>
		                <td th:text="${clie.telefono}"></td>
		                <td th:text="${clie.genero}"></td>
		                <td th:text="${clie.fechaNacimiento}"></td>
		                <td th:text="${clie.usuario.correo}"></td>

		                <!-- ESTADO -->
		                <td class="text-center">
		                    <span th:if="${clie.estado == 'Activo'}"
		                          class="badge bg-success">ACTIVO</span>
		                    <span th:if="${clie.estado == 'Inactivo'}"
		                          class="badge bg-danger">INACTIVO</span>
		                </td>

		                <!-- OPCIONES -->
		                <td class="text-left">
							
							<a th:href="@{/Cliente/ver/{id}(id=${clie.idCliente})}"
							   class="btn btn-info btn-sm">
							    <i class="fa-solid fa-eye"></i>
							    Ver
							</a>

		                    <!-- ACTIVAR (SOLO SI ESTA INACTIVO) -->
		                    <button th:if="${clie.estado == 'Inactivo'}"
		                            class="btn btn-success btn-sm"
		                            data-bs-toggle="modal"
		                            th:data-bs-target="'#activarModal' + ${clie.idCliente}">
		                        <i class="fa-solid fa-check"></i>
		                        Activar
		                    </button>

		                    <!-- MODAL ACTIVAR -->
		                    <div class="modal fade"
		                         th:id="'activarModal' + ${clie.idCliente}"
		                         tabindex="-1">
		                        <div class="modal-dialog modal-dialog-centered">
		                            <div class="modal-content">

		                                <div class="modal-header bg-success text-white">
		                                    <h5 class="modal-title">Confirmar activación</h5>
		                                    <button type="button" class="btn-close"
		                                            data-bs-dismiss="modal"></button>
		                                </div>

		                                <div class="modal-body">
		                                    ¿Seguro que deseas <strong>activar</strong> este cliente?
		                                </div>

		                                <div class="modal-footer">
		                                    <button type="button"
		                                            class="btn btn-secondary"
		                                            data-bs-dismiss="modal">
		                                        Cancelar
		                                    </button>

		                                    <form th:action="@{/Cliente/activar/{id}(id=${clie.idCliente})}"
		                                          method="post">
		                                        <button type="submit"
		                                                class="btn btn-success">
		                                            Sí, activar
		                                        </button>
		                                    </form>
		                                </div>

		                            </div>
		                        </div>
		                    </div>

		                </td>
		            </tr>

		            </tbody>
		        </table>
		    </div>

		</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<script>
    $(document).ready(function () {
        $('#tablaClientes').DataTable({
            language: {
                url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
            }
        });
    });

    function actualizarReloj() {
        const ahora = new Date();
        document.getElementById('reloj').innerText =
            ahora.toLocaleDateString() + ' ' + ahora.toLocaleTimeString();
    }

    setInterval(actualizarReloj, 1000);
    actualizarReloj();
</script>

</body>
</html>
