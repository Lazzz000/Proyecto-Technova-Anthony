<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lista de Promociones - Panel Admin</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">

    <link rel="stylesheet" th:href="@{/css/promociones.css}">
</head>

<body class="bg-gray-100 font-[Poppins]">

<!-- HEADER -->
<div class="fixed top-0 w-full z-50 bg-white shadow-md flex items-center justify-between px-6 py-4">
    <div class="flex items-center gap-3 text-lg font-semibold text-gray-800">
        <i class="fa-solid fa-boxes-stacked text-blue-600"></i>
        Panel de Administración - Tienda Tecnológica
    </div>
    <div class="text-gray-700">
        Bienvenido: <span class="font-semibold" th:text="${adminNombre}">Admin</span>
        <div class="text-gray-600 text-sm" id="reloj">00/00/0000 00:00</div>
    </div>
</div>

<!-- LAYOUT -->
<div class="flex pt-20 min-h-screen">

    <!-- SIDEBAR -->
    <aside class="w-64 bg-gray-800 text-gray-200 fixed top-20 left-0 h-[calc(100vh-5rem)] shadow-lg">
        <nav class="flex flex-col mt-4 gap-1 px-3">
            <a th:href="@{/PaginaAdmin/PanelAdmin}"
               class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-700">
                <i class="fa fa-chart-line text-blue-400"></i> Dashboard
            </a>

            <a th:href="@{/mantenimientoProductos/lista}"
               class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-700 text-white">
                <i class="fa fa-box text-blue-400"></i> Productos
            </a>

            <a th:href="@{/mantenimientoProductos/nuevo}"
               class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-700">
                <i class="fa fa-plus text-blue-400"></i> Nuevo Producto
            </a>
			
			<a th:href="@{/admin/pedidos}"
						              class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-700">
						               <i class="fa-solid fa-shopping-cart text-blue-400"></i> Pedido
						           </a>
			
            <a th:href="@{/mantenimientoDescuentos/listaDescuentos}"
               class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-700">
                <i class="fa-solid fa-tag text-blue-400"></i>Descuentos
            </a>

            <a th:href="@{/mantenimientoPromociones/listaPromociones}"
               class="flex items-center gap-3 px-4 py-3 rounded-lg bg-gray-700 text-center">
           <i class="fa-solid fa-bullhorn  text-blue-400"></i> Promociones
            </a>
			

            <a th:href="@{/logout}"
               class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-red-600 mt-auto">
                <i class="fa fa-right-from-bracket text-red-400"></i> Cerrar sesión
            </a>
        </nav>
    </aside>

    <!-- CONTENIDO -->
    <main class="ml-64 flex-1 p-8">

        <h2 class="text-3xl font-semibold text-gray-800 mb-6 text-center">
            Gestión de Promociones
        </h2>



        <!-- FILTROS -->
        <div class="flex gap-3 mb-2 justify-center">

            <!-- BOTON PARA ABRIR -->
            <a data-promo-nombre="" data-promo-id="" onclick="document.getElementById('dlgProductos').showModal()"
               class="btn btn-success text-white">
                <i class="fa-solid fa-square-plus"></i> Nueva Promocion
            </a>

            <!-- ===== DIALOG ===== -->
            <dialog id="dlgProductos">

                <div class=" flex-1 ">
                    <div class="max-w-4xl mx-auto">

                        <div class="card shadow-lg rounded-2xl">
                            <div class="card-header bg-gradient-to-r from-blue-500 to-blue-700 text-white text-center py-4">
                                <h3 class="text-xl font-semibold" id="titulo-dialog">Nueva Promoción</h3>
                            </div>

                            <div class="card-body p-6">


                                <!-- Promocion -->
                                <div class="mb-3">
                                    <label class="form-label">Nombre Promocion</label>
                                    <input type="text" name="nombrePromocion" id="nombrePromocion" class="form-control" required>
                                </div>




                                <!-- ACCIONES -->
                                <div class="acciones text-center">
                                    <!-- Botón -->
                                    <button class="cancelar btn btn-secondary btn-lg px-5"
                                             id="cerrarModal">
                                        Cancelar
                                    </button>
                                    <button id="guardar" class="btn btn-primary btn-lg px-5">
                                        <i class="fa-solid fa-floppy-disk"></i> Guardar
                                    </button>

                                </div>



                                <!-- Mensajes -->

                                <div class="alert alert-danger mt-4 text-center d-none mb-0" id="mensaje-error">

                                </div>

                            </div>
                        </div>
                    </div>
                </div>





            </dialog>
        </div>

        <!-- TABLA -->
        <div class="flex justify-center">
            <div style="width:800px;" class="bg-white p-4 rounded-lg shadow">
                <table id="tablaPromociones" class="table table-striped table-hover table-bordered w-full">
                    <thead class="table-dark text-center">
                    <tr>
                        <th>ID</th>

                        <th>Nombre</th>

                        <th>Opciones</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:each="p : ${listaPromociones}" class="text-center align-middle">
                        <td th:text="${p.idPromocion}"></td>

                        <td  th:text="${p.nombrePromo}"></td>


                        <td>
                            <div class="flex gap-2 justify-center">
                                <a th:data-promo-nombre="${p.nombrePromo}" th:data-promo-id="${p.idPromocion}"
                                   onclick="editarPromocion(this);return false;"
                                   class="btn btn-warning btn-sm">
                                    <i class="fa fa-edit"></i>
                                </a>


                                <a href="#"
                                   class="btn btn-sm btn-danger"

                                   data-bs-toggle="modal"
                                   data-bs-target="#modalEstado"
                                   th:data-id="${p.idPromocion}">
                                    <i class="fa fa-power-off"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>


    </main>

    <div class="modal fade" id="modalEstado" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">Confirmar acción</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    ¿Seguro que deseas eliminar esta Promoción?
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Cancelar
                    </button>

                    <a id="btnConfirmarEstado" class="btn btn-danger">
                        Sí
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- JS -->
<script th:src="@{/script/promociones.js}"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<script>
    document.querySelectorAll('input[type="date"]').forEach(input => {
        input.addEventListener('click', function () {
            this.blur();
            this.showPicker();

        });

    });
    $(document).ready(function () {
        $('#tablaPromociones').DataTable({
            language: {
                url: "//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
            },
            pageLength: 10,
            lengthMenu: [5, 10, 25, 50],
            columnDefs: [
                { orderable: false, targets: [1, 2] }
            ]
        });
    });
	
		function actualizarReloj() {
		    const ahora = new Date();
		    const dia = String(ahora.getDate()).padStart(2, '0');
		    const mes = String(ahora.getMonth() + 1).padStart(2, '0'); // Enero = 0
		    const anio = ahora.getFullYear();
		    const hora = String(ahora.getHours()).padStart(2, '0');
		    const minutos = String(ahora.getMinutes()).padStart(2, '0');
		    const segundos = String(ahora.getSeconds()).padStart(2, '0');
		    document.getElementById('reloj').innerText = `${dia}/${mes}/${anio} ${hora}:${minutos}:${segundos}`;
		}

		// Actualiza cada segundo
		setInterval(actualizarReloj, 1000);
		actualizarReloj(); 
		
		
		document.addEventListener("DOMContentLoaded", function () {

		    const modal = document.getElementById('modalEstado');
		    const btnConfirmar = document.getElementById('btnConfirmarEstado');

		    modal.addEventListener('show.bs.modal', function (event) {
		        const button = event.relatedTarget;
		        const id = button.getAttribute('data-id');

				btnConfirmar.addEventListener('click', function () {
                    try {
                        const response = fetch(`/mantenimientoPromociones/eliminar/${id}`, {
                            method: 'POST',
                            headers: { 'X-Requested-With': 'XMLHttpRequest' }
                        })
                        .then(res => {
                            if(!res.ok) throw new Error("Error");
                            location.reload();
                        })
                        .catch(err => {
                            console.error(err);
                        });

                    } catch (error) {
                        console.error("Error:", error);
                    }

                });
		    });

		});
</script>

</body>
</html>
